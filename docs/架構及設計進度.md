# 🏗️ 架構設計

## 整體架構

```text
PrintCoord
├── 📁 模板管理 (Template Management)
│   ├── 📤 上傳模組 (Upload Module)
│   ├── 👁️ 預覽模組 (Preview Module)
│   └── 💾 儲存模組 (Storage Module)
├── 🎯 欄位編輯 (Field Editor)
│   ├── 📍 位置標記 (Position Marker)
│   ├── 🔍 OCR 掃描 (OCR Scanner)
│   └── ⚙️ 屬性設定 (Property Settings)
├── 📊 資料填入 (Data Filling)
│   ├── 📝 表單介面 (Form Interface)
│   ├── 🔗 資料綁定 (Data Binding)
│   └── 📋 批量處理 (Batch Processing)
└── 📤 輸出系統 (Output System)
    ├── 🖨️ PDF 生成 (PDF Generation)
    ├── 📄 Word 輸出 (Word Export)
    └── 💾 JSON 配置 (JSON Config)
```

## 資料流程

```text
1. 上傳文件 → 2. 轉換成 Canvas → 3. 標記欄位 → 4. 儲存 JSON → 5. 填入資料 → 6. 生成文件
```

## OCR 掃描與套表流程

1. **掃描輸入**：以固定 DPI（建議 300 dpi）掃描紙本 A4 表格，確保取得穩定的像素尺寸。
2. **OCR 處理**：`OCRService.recognizeText` 擷取每個詞的文字、置信度與像素 `bbox`，必要時呼叫 `mergeNearbyTextRegions` 合併同一列文字。
3. **座標換算**：依掃描 DPI 將像素轉換成 pt（`pt = pixels × 72 ÷ dpi`）或比例座標，對應 A4 寬 210 mm、高 297 mm。
4. **欄位定義**：整理欄位名稱、文字結果及換算後座標，輸出 JSON，例如：

   ```json
   {
     "field": "applicantName",
     "position": { "x": 0.25, "y": 0.12, "width": 0.18, "height": 0.03 },
     "unit": "relative"
   }
   ```

5. **套表列印**：列印時按 JSON 座標比例將資料回填至 A4 模板，達成掃描 → JSON → 印製的一致流程。

## 關鍵技術點

- **文件解析**: 將 Word/PDF 轉換成可編輯的 Canvas
- **位置定位**: 精確的 X,Y 座標系統
- **資料映射**: JSON 配置與實際資料的動態綁定
- **格式保持**: 保持原始文件的排版和樣式

---

## 📦 **預計應用的套件**

### **核心依賴**

```json
{
  "dependencies": {
    "mammoth": "^1.11.0",              // Word 文件解析
    "pdfjs-dist": "^5.4.394",          // PDF 文件解析
    "docx": "^8.5.0",                  // Word 文件生成
    "fabric": "^6.9.0",                // Canvas 操作
    "konva": "^9.3.6",                 // Canvas 框架 (備選)
    "tesseract.js": "^6.0.1",          // 文字識別
    "@huggingface/inference": "^2.6.4", // AI 分析 (可選)
    "file-saver": "^2.0.5",            // 檔案下載
    "jszip": "^3.10.1",                // 檔案壓縮
    "uuid": "^9.0.1",                  // 唯一 ID
    "react-dropzone": "^14.3.8",       // 拖拽上傳
    "react-colorful": "^5.6.1",        // 顏色選擇器
    "react-hotkeys-hook": "^4.5.0"     // 鍵盤快捷鍵
  },
  "devDependencies": {
    "@types/file-saver": "^2.0.7",
    "@types/uuid": "^9.0.8"
  }
}
```

### **套件選擇理由**

- **mammoth**: 專門處理 Word 文件，轉換成 HTML
- **pdfjs-dist**: Mozilla 的 PDF 處理庫，非常可靠
- **fabric.js**: 功能強大的 Canvas 框架，支援物件操作
- **tesseract.js**: 免費的 OCR 引擎，可以識別表格文字

---

## 🚀 **開發計劃**

### **階段一: MVP (2-3 週)**

- [ ] 基本文件上傳 (Word/PDF)
- [ ] 文件預覽 (Canvas 渲染)
- [ ] 手動欄位標記 (拖拽選擇)
- [ ] JSON 配置儲存
- [ ] 基本資料填入

### **階段二: 增強功能 (2-3 週)**

- [ ] OCR 自動識別
- [ ] 智慧欄位建議
- [ ] 批量處理
- [ ] 模板庫管理

### **階段三: 商業化 (1-2 週)**

- [ ] 用戶系統
- [ ] 模板分享
- [ ] API 介面
- [ ] 付費功能
