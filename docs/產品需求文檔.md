# 📄 表格模板數字化系統 - 產品需求文檔

## 🎯 **產品說明**

### **產品名稱**: TableTemplate Pro (表格模板專業版)

### **核心價值**

將任何紙本表格文件（Word/PDF）轉換成可重複使用的數位模板，讓用戶能夠：

- 📤 上傳空白表格文件 (支援 .doc, .docx, .pdf)
- 🎯 精確標記資料欄位位置
- 💾 儲存為 JSON 配置
- 🔄 動態填入資料生成新文件

### **支持的文件格式**

- **Word 文檔**: .doc (舊格式), .docx (新格式)
- **PDF 文檔**: .pdf
- **未來支援**: Excel (.xlsx), 圖片等

### **目標用戶**

- 企業行政人員（處理大量表格文件）
- 開發者（需要動態文件生成）
- 任何需要重複填寫表格的人

### **主要場景**

1. **出貨單生成** - 上傳空白出貨單模板 → 標記欄位 → 批量填入訂單資料
2. **對帳單處理** - 客戶對帳單模板 → 自動填入交易資料
3. **報價單製作** - 產品報價模板 → 動態調整價格和項目

---

## 🛠️ **使用工具**

### **核心技術棧**

- **Frontend**: Next.js 16 + React 18 + TypeScript
- **UI Framework**: Tailwind CSS + Shadcn/ui
- **狀態管理**: Zustand (輕量級)
- **表單處理**: React Hook Form

### **文件處理工具**

- **Word 解析**: mammoth.js
- **PDF 解析**: pdfjs-dist
- **Canvas 操作**: Fabric.js
- **OCR 識別**: Tesseract.js
- **文件下載**: file-saver

### **開發工具**

- **包管理**: pnpm
- **代碼品質**: ESLint + Prettier
- **測試**: Jest + React Testing Library
- **部署**: Vercel

---

## 🏗️ **架構設計**

### **整體架構**

```
TableTemplate Pro
├── 📁 模板管理 (Template Management)
│   ├── 📤 上傳模組 (Upload Module)
│   ├── 👁️ 預覽模組 (Preview Module)
│   └── 💾 儲存模組 (Storage Module)
├── 🎯 欄位編輯 (Field Editor)
│   ├── 📍 位置標記 (Position Marker)
│   ├── 🔍 OCR 掃描 (OCR Scanner)
│   └── ⚙️ 屬性設定 (Property Settings)
├── 📊 資料填入 (Data Filling)
│   ├── 📝 表單介面 (Form Interface)
│   ├── 🔗 資料綁定 (Data Binding)
│   └── 📋 批量處理 (Batch Processing)
└── 📤 輸出系統 (Output System)
    ├── 🖨️ PDF 生成 (PDF Generation)
    ├── 📄 Word 輸出 (Word Export)
    └── 💾 JSON 配置 (JSON Config)
```

### **資料流程**

```
1. 上傳文件 → 2. 轉換成 Canvas → 3. 標記欄位 → 4. 儲存 JSON → 5. 填入資料 → 6. 生成文件
```

### **關鍵技術點**

- **文件解析**: 將 Word/PDF 轉換成可編輯的 Canvas
- **位置定位**: 精確的 X,Y 座標系統
- **資料映射**: JSON 配置與實際資料的動態綁定
- **格式保持**: 保持原始文件的排版和樣式

---

## 📦 **預計應用的套件**

### **核心依賴**

```json
{
  "dependencies": {
    // 文件處理
    "mammoth": "^1.6.0",              // Word .docx 文件解析
    "docx-preview": "^0.3.1",         // Word 文件預覽
    "mammoth-docx-to-html": "^1.0.0", // 舊版 mammoth (備選)
    "pdfjs-dist": "^4.0.269",         // PDF 文件解析
    "docx": "^8.5.0",                 // Word 文件生成

    // .doc 格式處理 (需要轉換)
    "office-document-reader": "^1.0.0", // 舊版 Office 文件讀取 (可選)
    "libreoffice-convert": "^1.0.0",    // 使用 LibreOffice 轉換 .doc (可選)

    // Canvas & 圖形處理
    "fabric": "^6.0.0",               // Canvas 物件操作
    "konva": "^9.3.6",                // 另一個 Canvas 框架 (備選)

    // OCR & AI
    "tesseract.js": "^5.0.4",         // 文字識別
    "@huggingface/inference": "^2.6.4", // AI 文字分析 (可選)

    // 工具庫
    "file-saver": "^2.0.5",           // 文件下載
    "jszip": "^3.10.1",               // 文件壓縮
    "uuid": "^9.0.1",                 // 唯一 ID 生成

    // UI 增強
    "react-dropzone": "^14.2.3",      // 文件拖拽上傳
    "react-colorful": "^5.6.1",       // 顏色選擇器
    "react-hotkeys-hook": "^4.5.0"    // 鍵盤快捷鍵
  },

  "devDependencies": {
    "@types/file-saver": "^2.0.7",
    "@types/uuid": "^9.0.8"
  }
}
```

### **套件選擇理由**

#### **文件格式處理**

- **mammoth**: 專門處理 .docx 格式，轉換成 HTML/CSS
- **docx-preview**: 在瀏覽器中預覽 Word 文件
- **pdfjs-dist**: Mozilla 的 PDF 處理庫，解析 PDF 成 Canvas
- **office-document-reader**: 處理舊版 .doc 格式 (需要服務端轉換)

#### **Canvas 框架**

- **fabric.js**: 功能強大的 Canvas 物件操作框架，支援拖拽、縮放
- **konva.js**: 另一個 Canvas 框架，專注於動畫和互動

#### **OCR 與 AI**

- **tesseract.js**: 免費 OCR 引擎，可自動識別表格中的文字位置
- **@huggingface/inference**: AI 文字分析，智慧建議欄位類型

#### **文件處理策略**

1. **.docx**: 直接用 mammoth.js 解析
2. **.doc**: 先轉換成 .docx，再用 mammoth.js
3. **.pdf**: 用 pdfjs-dist 轉成 Canvas

---

## 🚀 **開發計劃**

### **階段一: MVP (2-3 週)**

- [ ] 基本文件上傳 (Word/PDF)
- [ ] 文件預覽 (Canvas 渲染)
- [ ] 手動欄位標記 (拖拽選擇)
- [ ] JSON 配置儲存
- [ ] 基本資料填入

### **階段二: 增強功能 (2-3 週)**

- [ ] OCR 自動識別
- [ ] 智慧欄位建議
- [ ] 批量處理
- [ ] 模板庫管理

### **階段三: 商業化 (1-2 週)**

- [ ] 用戶系統
- [ ] 模板分享
- [ ] API 介面
- [ ] 付費功能

---

**請確認這個架構和套件清單，我們就可以開始開發了！** 🎯
