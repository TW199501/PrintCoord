# å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹è¨­è¨ˆ

## ğŸ“ ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯ (Frontend)                      â”‚
â”‚                      Next.js 16 + React                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - æ–‡ä»¶ä¸Šå‚³ç•Œé¢                                              â”‚
â”‚  - PDF é è¦½                                                  â”‚
â”‚  - è¡¨æ ¼ç·¨è¼¯å™¨                                                â”‚
â”‚  - æ¬„ä½ç®¡ç†                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ RESTful API / GraphQL
                       â”‚ (HTTP/HTTPS)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¾Œç«¯ API (Backend)                      â”‚
â”‚                    Next.js API Routes                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - PDF ä¸Šå‚³è™•ç† (/api/pdf/upload)                           â”‚
â”‚  - æ–‡æª”ç®¡ç† (/api/pdf/:id)                                  â”‚
â”‚  - æ¬„ä½æª¢æ¸¬ (/api/pdf/:id/fields)                           â”‚
â”‚  - æ•¸æ“šå°å‡º (/api/pdf/:id/export)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¥­å‹™é‚è¼¯å±¤ (Services)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - PDF2JSONService (PDF è§£æ)                               â”‚
â”‚  - PDFDatabaseService (æ•¸æ“šåº«æ“ä½œ)                          â”‚
â”‚  - FieldDetectionService (æ¬„ä½æª¢æ¸¬)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•¸æ“šåº« (Database)                           â”‚
â”‚              PostgreSQL / SQLite                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - pdf_documents (æ–‡æª”è¡¨)                                   â”‚
â”‚  - table_structures (è¡¨æ ¼çµæ§‹è¡¨)                            â”‚
â”‚  - detected_fields (æª¢æ¸¬æ¬„ä½è¡¨)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ æ•¸æ“šåº«é¸æ“‡

### é–‹ç™¼ç’°å¢ƒï¼šSQLite

- âœ… é›¶é…ç½®ï¼Œæ–‡ä»¶å‹æ•¸æ“šåº«
- âœ… é©åˆæœ¬åœ°é–‹ç™¼å’Œæ¸¬è©¦
- âœ… è¼•é‡ç´šï¼Œç„¡éœ€é¡å¤–æœå‹™

```bash
# ä½¿ç”¨ SQLite
DATABASE_URL="file:./dev.db"
```

### ç”Ÿç”¢ç’°å¢ƒï¼šPostgreSQL â­

- âœ… å¼·å¤§çš„ JSONB æ”¯æŒï¼ˆå­˜å„² PDF2JSON è¼¸å‡ºï¼‰
- âœ… å®Œæ•´çš„ ACID äº‹å‹™
- âœ… é«˜ä¸¦ç™¼æ€§èƒ½
- âœ… è±å¯Œçš„ç´¢å¼•é¡å‹
- âœ… æ”¯æŒå…¨æ–‡æœç´¢

```bash
# ä½¿ç”¨ PostgreSQL
DATABASE_URL="postgresql://user:password@localhost:5432/pdfdb"
```

## ğŸ“¡ API ç«¯é»è¨­è¨ˆ

### 1. PDF æ–‡æª”ç®¡ç†

#### POST /api/pdf/upload

ä¸Šå‚³ä¸¦è™•ç† PDF æ–‡ä»¶

**Request:**

```typescript
Content-Type: multipart/form-data

{
  file: File
}
```

**Response:**

```typescript
{
  success: true,
  data: {
    documentId: string,
    filename: string,
    pageCount: number,
    status: 'processing' | 'processed',
    fieldsDetected: number
  }
}
```

#### GET /api/pdf/:id

ç²å– PDF æ–‡æª”ä¿¡æ¯

**Response:**

```typescript
{
  success: true,
  data: {
    id: string,
    filename: string,
    title: string,
    pageCount: number,
    status: string,
    createdAt: string,
    updatedAt: string
  }
}
```

#### GET /api/pdf/:id/fields

ç²å–æª¢æ¸¬åˆ°çš„æ¬„ä½

**Query Parameters:**

- `page?: number` - é ç¢¼ï¼ˆå¯é¸ï¼‰
- `row?: number` - è¡Œç´¢å¼•ï¼ˆå¯é¸ï¼‰
- `col?: number` - åˆ—ç´¢å¼•ï¼ˆå¯é¸ï¼‰

**Response:**

```typescript
{
  success: true,
  data: {
    fields: Array<{
      id: string,
      name: string,
      value: string,
      position: { x: number, y: number },
      size: { width: number, height: number },
      type: string,
      pageIndex: number,
      rowIndex: number,
      colIndex: number
    }>,
    total: number
  }
}
```

#### GET /api/pdf/:id/export

å°å‡ºç‚º JSON

**Query Parameters:**

- `format?: 'json' | 'csv' | 'excel'`

**Response:**

```typescript
{
  success: true,
  data: {
    downloadUrl: string,
    format: string,
    size: number
  }
}
```

#### DELETE /api/pdf/:id

åˆªé™¤ PDF æ–‡æª”

**Response:**

```typescript
{
  success: true,
  message: 'Document deleted successfully'
}
```

### 2. è¡¨æ ¼çµæ§‹ç®¡ç†

#### GET /api/pdf/:id/structure

ç²å–è¡¨æ ¼çµæ§‹ä¿¡æ¯

**Response:**

```typescript
{
  success: true,
  data: {
    pages: Array<{
      pageIndex: number,
      rows: number,
      columns: number,
      strategy: 'fills' | 'lines' | 'text',
      gridData: {
        horizontalLines: number,
        verticalLines: number,
        columnBoundaries: number[],
        rowBoundaries: number[]
      }
    }>
  }
}
```

## ğŸ”§ æŠ€è¡“æ£§

### å‰ç«¯

- **æ¡†æ¶**: Next.js 16 (App Router)
- **UI**: React + TailwindCSS + shadcn/ui
- **ç‹€æ…‹ç®¡ç†**: React Context / Zustand
- **HTTP å®¢æˆ¶ç«¯**: Fetch API / Axios

### å¾Œç«¯

- **æ¡†æ¶**: Next.js API Routes
- **PDF è™•ç†**: pdf2json
- **ORM**: Prisma / Drizzle ORM
- **é©—è­‰**: Zod
- **æ–‡ä»¶å­˜å„²**: æœ¬åœ°æ–‡ä»¶ç³»çµ± / S3

### æ•¸æ“šåº«

- **é–‹ç™¼**: SQLite
- **ç”Ÿç”¢**: PostgreSQL 15+
- **é·ç§»**: Prisma Migrate / Drizzle Kit

## ğŸ“¦ éƒ¨ç½²æ–¹æ¡ˆ

### é¸é … 1ï¼šVercel (æ¨è–¦)

```bash
# è‡ªå‹•éƒ¨ç½²
vercel --prod

# ç’°å¢ƒè®Šé‡
DATABASE_URL=postgresql://...
```

### é¸é … 2ï¼šDocker

```dockerfile
# Dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=postgresql://postgres:password@db:5432/pdfdb
    depends_on:
      - db
  
  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=pdfdb
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  postgres_data:
```

### é¸é … 3ï¼šå‚³çµ±æœå‹™å™¨

```bash
# ä½¿ç”¨ PM2
npm install -g pm2
npm run build
pm2 start npm --name "pdf-app" -- start
```

## ğŸ” å®‰å…¨è€ƒæ…®

1. **æ–‡ä»¶ä¸Šå‚³é™åˆ¶**
   - æœ€å¤§æ–‡ä»¶å¤§å°ï¼š10MB
   - å…è¨±çš„æ–‡ä»¶é¡å‹ï¼š.pdf
   - æ–‡ä»¶åæ¶ˆæ¯’

2. **API èªè­‰**
   - JWT Token
   - API Key
   - Rate Limiting

3. **æ•¸æ“šåº«å®‰å…¨**
   - åƒæ•¸åŒ–æŸ¥è©¢ï¼ˆé˜²æ­¢ SQL æ³¨å…¥ï¼‰
   - é€£æ¥åŠ å¯†
   - å®šæœŸå‚™ä»½

## ğŸ“Š æ€§èƒ½å„ªåŒ–

1. **æ•¸æ“šåº«ç´¢å¼•**
   - æ–‡æª” ID ç´¢å¼•
   - ç‹€æ…‹ç´¢å¼•
   - JSONB GIN ç´¢å¼•

2. **ç·©å­˜ç­–ç•¥**
   - Redis ç·©å­˜ç†±é–€æ–‡æª”
   - CDN ç·©å­˜éœæ…‹è³‡æº

3. **ç•°æ­¥è™•ç†**
   - ä½¿ç”¨éšŠåˆ—è™•ç†å¤§æ–‡ä»¶
   - å¾Œå°ä»»å‹™è™•ç†

## ğŸ”„ æ•¸æ“šæµç¨‹

```
1. ç”¨æˆ¶ä¸Šå‚³ PDF
   â†“
2. å‰ç«¯ç™¼é€åˆ° /api/pdf/upload
   â†“
3. å¾Œç«¯æ¥æ”¶æ–‡ä»¶
   â†“
4. PDF2JSONService è§£æ PDF
   â†“
5. æª¢æ¸¬è¡¨æ ¼å’Œæ¬„ä½
   â†“
6. ä¿å­˜åˆ° PostgreSQL
   â†“
7. è¿”å›æ–‡æª” ID çµ¦å‰ç«¯
   â†“
8. å‰ç«¯é¡¯ç¤ºçµæœ
```

## ğŸ“ ç’°å¢ƒè®Šé‡

```env
# .env.local
DATABASE_URL="postgresql://user:password@localhost:5432/pdfdb"
NODE_ENV="development"
MAX_FILE_SIZE="10485760" # 10MB
UPLOAD_DIR="./uploads"
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

```bash
# 1. å®‰è£ä¾è³´
pnpm install

# 2. è¨­ç½®æ•¸æ“šåº«
pnpm db:migrate

# 3. å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
pnpm dev

# 4. è¨ªå•
open http://localhost:3000
```
