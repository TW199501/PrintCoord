# 📄 PDF 解析修復測試指南

## 🎯 **修復概述**

本次修復主要解決了 PrintCoord 中 PDF 文件無法解析的問題，包括：

- ✅ PDF.js Worker 配置問題修復
- ✅ 模組載入路徑優化
- ✅ 錯誤處理和回饋增強
- ✅ 文件類型檢測改進
- ✅ 性能和穩定性提升

## 🔧 **修復內容詳解**

### **1. PDF.js Worker 配置修復**

**問題**：Worker 路徑設置錯誤導致 PDF 解析失敗

**解決方案**：

```typescript
// 設置多種 Worker 路徑嘗試
const workerPaths = [
  '/pdfjs/pdf.worker.mjs',
  '/_next/static/chunks/pdfjs/pdf.worker.mjs',
  '/public/pdfjs/pdf.worker.mjs'
];
```

### **2. 模組載入路徑優化**

**問題**：Next.js 環境中 PDF.js 匯入失敗

**解決方案**：

- 支援預載入 PDF.js
- 動態匯入備用方案
- 多種載入路徑嘗試

### **3. 錯誤處理增強**

**新增功能**：

- 詳細的錯誤分類和訊息
- 使用者友好的錯誤提示
- 具體的解決建議

## 🧪 **測試步驟**

### **基本功能測試**

1. **啟動應用**

   ```bash
   npm run dev
   ```

2. **測試不同類型的 PDF 文件**
   - 簡單文字 PDF（< 1MB）
   - 圖片為主的 PDF（1-5MB）
   - 混合內容 PDF（表格、文字、圖片）
   - 密碼保護的 PDF（應該顯示相應錯誤）

3. **觀察控制台輸出**
   - 檢查是否有 PDF.js 初始化成功的訊息
   - 確認 Worker 載入路徑正確

### **錯誤情況測試**

1. **無效文件測試**
   - 上傳空文件
   - 上傳損壞的 PDF 文件
   - 上傳非 PDF 文件（.txt, .jpg）

2. **大小限制測試**
   - 超過限制的 PDF 文件（> 20MB）
   - 正常大小的 PDF 文件（< 20MB）

3. **格式測試**
   - 加密的 PDF 文件
   - 掃描的 PDF 圖片
   - 數位化的 PDF 文字

### **預期結果**

✅ **成功情況**：

- PDF 文件上傳後顯示"解析成功"
- 顯示文件名稱和頁數
- 可以點擊"開始掃描"進行欄位檢測

❌ **失敗情況**：

- 顯示具體的錯誤訊息
- 提供解決建議
- 允許重新上傳

## 📊 **測試檢查清單**

| 測試項目 | 預期結果 | 測試狀態 |
|---------|---------|---------|
| 簡單 PDF 上傳 | ✅ 解析成功 | |
| 大型 PDF 上傳 | ✅ 解析成功 | |
| 損壞 PDF 上傳 | ❌ 顯示錯誤訊息 | |
| 空文件上傳 | ❌ 顯示錯誤訊息 | |
| 非 PDF 文件上傳 | ❌ 顯示錯誤訊息 | |
| 超大文件上傳 | ❌ 顯示大小限制錯誤 | |
| PDF Worker 載入 | ✅ 控制台顯示成功訊息 | |
| 錯誤訊息顯示 | ✅ 顯示使用者友好訊息 | |

## 🔍 **調試指南**

### **常見問題和解決方案**

#### **問題 1：Worker 載入失敗**

```
錯誤：PDF Worker 配置錯誤，請檢查瀏覽器相容性
```

**解決方案**：

- 檢查瀏覽器是否支援 Web Workers
- 確認 `/pdfjs/pdf.worker.mjs` 路徑存在
- 清除瀏覽器快取重新載入

#### **問題 2：PDF 文件損壞**

```
錯誤：PDF 文件已損壞或格式無效
```

**解決方案**：

- 使用 Adobe Reader 確認 PDF 可以正常開啟
- 嘗試重新匯出 PDF 文件
- 檢查文件是否完整下載

#### **問題 3：記憶體不足**

```
錯誤：PDF 文件過大，請嘗試較小的文件
```

**解決方案**：

- 壓縮 PDF 文件
- 分割大型 PDF 為多個小文件
- 減少 PDF 頁數

#### **問題 4：Canvas 渲染失敗**

```
錯誤：Canvas 渲染失敗，請檢查瀏覽器支援
```

**解決方案**：

- 更新瀏覽器到最新版本
- 檢查瀏覽器 Canvas 支援
- 嘗試其他瀏覽器

### **控制台調試訊息**

開啟瀏覽器開發者工具，檢查 Console 標籤中的訊息：

```
PDF.js 已載入，開始讀取文件陣列緩衝區
PDF 解析成功，共 X 頁
第 1 頁處理完成
PDF 文件處理完成，共處理 X 頁
```

## 🚀 **效能測試**

### **性能基準**

| 文件類型 | 大小 | 頁數 | 處理時間 | 記憶體使用 |
|---------|------|------|---------|-----------|
| 簡單文字 | 500KB | 5 | < 5秒 | < 50MB |
| 圖片為主 | 3MB | 10 | < 15秒 | < 100MB |
| 混合內容 | 8MB | 20 | < 30秒 | < 150MB |

### **效能優化建議**

1. **大型文件處理**
   - 建議分割超過 10MB 的 PDF 文件
   - 使用壓縮工具減少文件大小

2. **瀏覽器設定**
   - 確保瀏覽器有足夠記憶體
   - 關閉不必要的分頁減少資源競爭

3. **網路環境**
   - 確保穩定的網路連線
   - 避免在網路繁忙時段處理大型文件

## 📝 **測試報告範本**

請在測試完成後填寫此報告：

### **基本資訊**

- 測試日期：______
- 測試環境：Chrome/Firefox/Safari ____ 版本 ____
- 作業系統：Windows/Mac/Linux ____

### **測試結果**

1. **PDF 解析功能**
   - [ ] 简单 PDF 解析成功
   - [ ] 大型 PDF 解析成功
   - [ ] 損壞 PDF 錯誤處理正確

2. **錯誤處理**
   - [ ] 顯示具體錯誤訊息
   - [ ] 提供解決建議
   - [ ] 允許重新上傳

3. **使用者體驗**
   - [ ] 介面反應流暢
   - [ ] 進度顯示清楚
   - [ ] 錯誤提示友好

### **問題記錄**

如有任何問題，請詳細描述：

1. **問題描述**：______
2. **重現步驟**：______
3. **預期行為**：______
4. **實際行為**：______
5. **截圖/錄影**：如有請附加

### **總體評價**

- [ ] 優秀 - 所有功能正常運作
- [ ] 良好 - 主要功能正常，小問題
- [ ] 一般 - 有明顯問題需要修復
- [ ] 差 - 功能無法正常使用

---

## 🎉 **恭喜！**

完成以上測試後，您的 PDF 解析功能應該已經修復完成。如果遇到任何問題，請參考調試指南或提交問題報告。
